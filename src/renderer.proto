syntax = "proto3";

import "decentraland.proto";
import "engine_interface.proto";
package decentraland.renderer;

option csharp_namespace = "DCL.Interface";

message MessageFromRenderer {
  oneof message {
    ReportPosition report_position = 1;
    ReportMousePosition report_mouse_position = 2;
    SceneEvent scene_event = 3;
    LegacySceneEvent legacy_scene_event = 4;
    SceneEvent all_scenes_event = 5;
    LegacySceneEvent all_scenes_legacy_event = 6;
    OpenWebURL open_web_url = 7;
    PerformanceReport performance_report = 8;
    SystemInfoReport system_info_report = 9;
    TrackAnalyticsEvent track_analytics_event = 10;
    TriggerExpression trigger_expression = 11;
    MotdConfirmClicked message_of_the_day_confirm_clicked = 12;
    // FKA GoTo

    //  Condense all the teleport messages into one. TODO = 0;
    TeleportTo teleport_to = 13;
    TeleportToMagic teleport_to_magic = 14;
    TeleportToCrowd teleport_to_crowd = 15;
    // JumpIn jump_in = 38;

    LogOut logout = 16;
    RedirectToSignUp redirect_to_signup = 17;

    SaveAvatar save_avatar = 18;

    RequestOwnProfileUpdate request_profile_update = 19;
    SaveUserUnverifiedName save_user_unverified_name = 20;
    CloseUserAvatar close_user_avatar = 21;
    SaveUserTutorialStep save_tutorial_step = 22;

    // FKA SendScreenshot
    ScreenshotResponse screenshot_response = 23;

    // FKA ReportBuilderCameraTarget
    BuilderRaycastResponse builder_raycast_response = 24;

    UserAcceptedCollectibles user_accepted_collectibles = 25;
    SetDelightedSurveyEnabled set_delighted_survey_enabled = 26;

    // FKA ReportScene,ReportPlayer
    ReportContent report_content = 27;

    BlockPlayer block_player = 28;
    UnblockPlayer unblock_player = 29;

    RequestScenesInfoInArea request_scenes_info_in_area = 30;
    SetAudioStream set_audio_stream = 31;
    ChatMessage send_chat_message = 32;
    SetVoiceChatRecording set_voice_recording = 33;

    //  WHY DO WE HAVE BOTH SetVoiceChatRecording and ToggleVoiceChatRecording?? TODO = 0;
    ToggleVoiceChatRecording toggle_voice_recording = 34;

    // FKA ApplySettings
    SetVoiceChatSettings set_voice_chat_settings = 35;

    UpdateFriendshipStatus update_friendship_status = 36;
    FindEnsOwner find_ens_owner = 37;

    JumpIn jump_in = 38;

    ScenesLoadingFeedback scenes_loading_feedback = 39;

    FetchHotScenes fetch_hot_scenes = 40;
    SetBaseResolution set_base_resolution = 41;
    RequestGIFProcessor request_gif_processor = 42;
    DeleteGif delete_gif = 43;
    FetchManaBalance fetch_mana_balance = 44;
    MuteUsers mute_users = 45;
    KillPortableExperience kill_portable_experience = 46;
    RequestWearables request_wearables = 47;
    RequestProfile request_profile = 48;
    ReportAvatarFatalError report_avatar_fatal_error = 49;
  }

  message ReportAvatarFatalError {}

  message SaveUserTutorialStep {
    int32 tutorial_step = 1;
  }

  message RequestProfile {
    string user_id = 1;
  }

  message RequestWearables {
    optional string ownedByUser = 1;
    repeated string wearableIds = 2;
    repeated string collectionIds = 3;
    optional string context = 4;
  }
  message KillPortableExperience {
    string scene_id = 1;
  }
  message MuteUsers {
    bool mute = 1;
    repeated string users = 2;
  }
  message FetchManaBalance {}

  message DeleteGif {
    string gif_id = 1;
  }

  message RequestGIFProcessor {
    string gif_id = 1;
    string imageSource = 2;
    bool isWebGL1 = 3;
  }

  message SetBaseResolution {
    int32 base_resolution = 1;
  }

  message FetchHotScenes {}

  message ScenesLoadingFeedback {
    string message = 1;
    float loading_percentage = 2;
  }

  message JumpIn {
    string realm = 1;
    int32 parcel_x = 2;
    int32 parcel_y = 3;
  }

  message FindEnsOwner {
    string ens = 1;
    int32 max_results = 2;
  }

  message UpdateFriendshipStatus {
    string user_id = 1;
    FriendshipAction action = 2;
  }

  message SetVoiceChatSettings {
    float voiceChatVolume = 1;
    float voiceChatAllowCategory = 2;
  }

  message ToggleVoiceChatRecording {}

  message SetVoiceChatRecording {
    bool recording = 1;
  }


  message SetAudioStream {
    string url = 1;
    bool play = 2;
    float volume = 3;
  }

  message RequestScenesInfoInArea {
    int32 x = 1;
    int32 y = 2;
    reserved 3;
    int32 radius = 4;
  }

  /** Triggered when the camera moves */
  message ReportPosition {
    decentraland.Vector3 position = 1;
    decentraland.Quaternion rotation = 2;
    float playerHeight = 3;
    bool immediate = 4;
  }

  //  Is this a report or a response? TODO = 0;
  message ReportMousePosition {
    decentraland.Vector3 position = 1;
    string id = 2;
  }

  message LegacySceneEvent {
    string scene_id = 1;
    string event_name = 2;
    string json_payload = 3;
  }

  message SceneEvent {
    string scene_id = 1;
    oneof scene_event {
      EntityOutOfBoundaries entities_out_of_boundaries = 2;
    }

    message EntityOutOfBoundaries {
      repeated string entities = 1;
    }
  }

  message OpenWebURL {
    string url = 1;
  }

  message PerformanceReport {
    string samples = 1;
    bool fpsIsCapped = 2;
    int32 hiccupsInThousandFrames = 3;
    int32 hiccupsTime = 4;
    int32 totalTime = 5;
  }

  message SystemInfoReport {
    string graphicsDeviceName = 1;
    string graphicsDeviceVersion = 2;
    int32 graphicsMemorySize = 3;
    string processorType = 4;
    int32 processorCount = 5;
    int32 systemMemorySize = 6;
  }

  message TrackAnalyticsEvent {
    string event_name = 1;
    map<string, string> properties = 2;
  }

  message TriggerExpression {
    string expression_id = 1;
    int32 timestamp = 2;
  }

  message MotdConfirmClicked {}

  message TeleportTo {
    int32 x = 1;
    int32 y = 2;
  }
  message TeleportToMagic {}
  message TeleportToCrowd {}

  message LogOut {}

  message RedirectToSignUp {}

  message SaveAvatar {
    AvatarInfo avatar = 1;
    bytes face = 2;
    bytes face128 = 3;
    bytes face256 = 4;
    bytes body = 5;
    bool isSignUpFlow = 6;
  }

  message AvatarInfo {
    string bodyShape = 1;
    string skinColor = 2;
    string hairColor = 3;
    string eyeColor = 4;
    repeated string wearables = 5;
  }

  message RequestOwnProfileUpdate {}
  message SaveUserUnverifiedName {
    string name = 1;
  }

  message CloseUserAvatar {
    bool is_sign_up_flow = 1;
  }

  message ScreenshotResponse {
    string id = 1;
    bytes image_data = 2;
  }

  message BuilderRaycastResponse {
    string request_id = 1;
    decentraland.Vector3 position = 2;
  }

  message UserAcceptedCollectibles {
    string collectible_id = 1;
  }
  message SetDelightedSurveyEnabled {
    bool enabled = 1;
  }
  message ReportContent {
    string scene_id = 1;
    string user_id = 2;
  }
  message BlockPlayer {
    string user_id = 1;
  }
  message UnblockPlayer {
    string user_id = 1;
  }
}


message MessageToRenderer {
  oneof message {
    decentraland.renderer.engine.SceneMessage send_scene_message = 1;
    SetDebug set_debug = 2;
    LoadProfile load_profile = 3;
    SetRenderProfile set_render_profile = 4;
    DumpScenesLoadInfo dump_scenes_load_info = 5;
    DumpRendererLockersInfo dump_render_lockers_info = 6;
    CreateGlobalScene create_global_scene = 7;
    LoadParcelScenes load_parcel_scene = 8;
    UpdateParcelScenes update_parcel_scenes = 9;
    UnloadScene unload_scene = 10;
    SetSceneDebugPanel set_debug_panel = 11;
    ShowFPSPanel show_fps_panel = 12;
    HideFPSPanel hide_fps_panel = 13;
    SetEngineDebugPanel set_engine_debug_panel = 14;
    SetDisableAssetBundles set_disable_asset_bundles = 15;
    ActivateRendering activate_rendering = 16;
    DeactivateRendering deactivate_rendering = 17;
    ReportFocusOn report_focus_on = 18;
    ReportFocusOff report_focus_off = 19;
    SetCursorState set_cursor_state = 20;
    SetBuilderReady set_builder_ready = 21;
    AddUserProfileToCatalog add_user_profile_to_catalog = 22;
    AddWearablesToCatalog add_wearables_to_catalog = 23;
    WearablesRequestFailed wearable_request_failed = 24;
    RemoveWearablesFromCatalog remove_wearables_from_catalog = 25;
    ClearWearableCatalog clear_wearable_catalog = 26 ;
    ShowNotification show_notification = 27 ;
    ConfigureHUDElement configure_hud_element = 28 ;
    ShowWelcomeNotification show_welcome_notification = 29 ;
    TriggerSelfUserExpression trigger_self_user_expression = 30 ;
    UpdateMinimapSceneInformation update_minimap_scene_information = 31 ;
    SetTutorialEnabled set_tutorial_enabled = 32 ;
    SetTutorialEnabledForUsersThatAlreadyDidTheTutorial set_tutorial_enabled_for_users_that_already_did_the_tutorial = 33 ;
    TriggerAirdropDisplay trigger_airdrop_display = 34 ;
    AddMessageToChatWindow add_message_to_chat_window = 35 ;
    InitializeFriends initialize_friends = 36 ;
    UpdateFriendshipStatus update_friendship_status = 37 ;
    UpdateUserPresence update_user_presence = 38 ;
    FriendNotFound friend_not_found = 39 ;
    RequestTeleport request_teleport = 40 ;
    UpdateHotScenesList update_hot_scenes_list = 41 ;
    SendGIFPointers send_gif_pointers = 42 ;
    SendGIFFetchFailure send_gif_fetch_failure = 43 ;
    ConfigureEmailPrompt configure_email_prompt = 44 ;
    ConfigureTutorial configure_tutorial = 45 ;
    UpdateBalanceOfMANA update_balance_of_mana = 46 ;
    SetPlayerTalking set_player_talking = 47 ;
    ShowAvatarEditorInSignIn show_avatar_editor_in_sign_in = 48 ;
    SetUserTalking set_user_talking = 49 ;
    SetUsersMuted set_users_muted = 50 ;
    SetVoiceChatEnabledByScene set_voice_chat_enabled_by_scene = 51 ;
    SetKernelConfiguration set_kernel_configuration = 52 ;
    UpdateRealmsInfo update_realms_info = 53 ;
    SendPublishSceneResult send_publish_scene_result = 54 ;
    SetENSOwnerQueryResult set_ens_owner_query_result = 55 ;

    SelectGizmoBuilder select_gizmo_builder = 57 ;
    ResetBuilderObject reset_builder_object = 58 ;
    SetCameraZoomDeltaBuilder set_camera_zoom_delta_builder = 59 ;
    GetCameraTargetBuilder get_camera_target_builder = 60 ;
    SetPlayModeBuilder set_play_mode_builder = 61 ;
    PreloadFileBuilder preload_file_builder = 62 ;
    GetMousePositionBuilder get_mouse_position_builder = 63 ;
    TakeScreenshotBuilder take_screenshot_builder = 64 ;
    SetCameraPositionBuilder set_camera_position_builder = 65 ;
    SetCameraRotationBuilder set_camera_rotation_builder = 66 ;
    ResetCameraZoomBuilder reset_camera_zoom_builder = 67 ;
    SetBuilderGridResolution set_builder_grid_resolution = 68 ;
    SetBuilderSelectedEntities set_builder_selected_entities = 69 ;
    ResetBuilderScene reset_builder_scene = 70 ;
    OnBuilderKeyDown on_builder_key_down = 71 ;
    SetBuilderConfiguration set_builder_configuration = 72 ;
  }

  message SetDisableAssetBundles {}
  message ActivateRendering {}
  message DeactivateRendering {}
  message ReportFocusOn {}
  message ReportFocusOff {}

  message SetBuilderReady {}
  message AddUserProfileToCatalog {
    ProfileForRenderer profile = 1;
  }

  message AddWearablesToCatalog {
    optional string context = 1;
    repeated Wearable wearables = 2;
  }

  message Wearable {
    string wearable_id = 1;
    string rarity = 2;
    map<string, string> i18n = 3;
    string thumbnail = 4;
    string description = 5;

    string category = 6;
    repeated string tags = 7;
    repeated string hides = 8;
    repeated string replaces = 9;
    repeated BodyShapeRepresentation representations = 10;

    string baseUrl = 11;
    string baseUrlBundles = 12;
  }

  message BodyShapeRepresentation {
    string mainFile = 1;
    repeated string bodyShapes = 2;
    repeated string overrideHides = 3;
    repeated string overrideReplaces = 4;
    repeated decentraland.ContentMapping mappings = 5;
  }

  message WearablesRequestFailed {
    string error = 1;
    optional string context = 2;
  }
  message RemoveWearablesFromCatalog {
    repeated string wearable_ids = 1;
  }

  message ClearWearableCatalog {}




  message ShowWelcomeNotification {}
  message ShowAvatarEditorInSignIn {}
  message ResetBuilderScene {}
  message ResetCameraZoomBuilder {}
  message ResetBuilderObject {}

  message ShowNotification {
    message Notification {
      NotificationType type = 1;
      string message = 2;
      string buttonMessage = 3;
      int32 timer = 4; // in seconds
      string scene = 5;
      string externalCallbackID = 6;
    }
    Notification notification = 1;
  }
  message ConfigureHUDElement {
  
  }
  message TriggerSelfUserExpression {
    string expressionId = 1;
  }
  message UpdateMinimapSceneInformation {
    message MinimapSceneInfo {
      string name = 1;
      string owner = 2;
      string description = 3;
      optional string previewImageUrl = 4;
      int32 type = 5;
      repeated decentraland.ParcelPosition parcels = 6;
      bool isPOI = 7;
    }
    repeated MinimapSceneInfo info = 1;
  }

  message TutorialInitializationMessage {
    bool fromDeepLink = 1;
    bool enableNewTutorialCamera = 2;
  }

  message SetTutorialEnabled {
    TutorialInitializationMessage tutorialConfig = 1;
  }
  message SetTutorialEnabledForUsersThatAlreadyDidTheTutorial {
    TutorialInitializationMessage tutorialConfig = 1;
  }

  message AirDropInfo {
    // export type AirdropInput = {
    //    string id = 0;
    //    string title = 0;
    //    string subtitle = 0;
    //    repeated AirdropItem items = 0;
    // }
    // export type AirdropInfo = {
    //    string id = 0;
    // } & AirdropInput
    
    // export type RarityEnum = 'common' | 'uncommon' | 'rare' | 'epic' | 'mythic' | 'legendary' | 'unique'
    
    // export type AirdropItem = {
    //    string name = 0;
    //    string subtitle? = 0;
    //    string thumbnailURL = 0;
    //    RarityEnum rarity = 0;
    //    'collectible' | 'erc20' type = 0;
    // }
  }

  message TriggerAirdropDisplay {
    AirDropInfo data = 1;
  }
  message AddMessageToChatWindow {
    ChatMessage message = 1;
  }

  message InitializeFriends {
    repeated string currentFriends = 1;
    repeated string requestedTo = 2;
    repeated string requestedFrom = 3;
  }
  message UpdateFriendshipStatus {
    string userId = 1;
    FriendshipAction action = 2;
  }
  message UpdateUserPresence {
    string userId = 1;
    string realm = 2;
    decentraland.Vector2 position = 3;
    PresenceStatus presence = 4;
  }
  message FriendNotFound {
    string queryString = 1;
  }
  message RequestTeleport {
    string destination = 1;
  }
  message UpdateHotScenesList {
    message HotSceneInfo {
      string id = 1;
      string name = 2;
      string creator = 3;
      string description = 4;
      string thumbnail = 5;
      decentraland.ParcelPosition baseCoord = 6;
      repeated decentraland.ParcelPosition parcels = 7;
      int32 usersTotalCount = 8;
      repeated RealmInfo realms = 9;
    }
    repeated HotSceneInfo info = 1;
  }
  message SendGIFPointers {
     string id = 1;
     int32 width = 2;
     int32 height = 3;
     repeated int32 pointers = 4;
     repeated int32 frameDelays = 5;
  }
  message SendGIFFetchFailure {
    string id = 1;
  }
  message ConfigureEmailPrompt {
    int32 tutorialStep = 1;
  }
  message ConfigureTutorial {
    int32 tutorialStep = 1;
    TutorialInitializationMessage tutorialConfig = 2;
  }
  message UpdateBalanceOfMANA {
    string balance = 1;
  }
  message SetPlayerTalking {
    bool talking = 2;
  }
  message SetUserTalking {
    string userId = 1;
    bool talking = 2;
  }
  message SetUsersMuted {
    repeated string userId = 1;
    bool muted = 2;
  }
  message SetVoiceChatEnabledByScene {
    bool enabled = 1;
  }
  message SetKernelConfiguration {
    int32 commRadius = 1;
    bool voiceChatEnabled = 2;
    string nameValidRegex = 3;
    string nameValidCharacterRegex = 4;
    bool enableBuilderInWorld = 5;
    bool gifSupported = 6;
    string tld = 7;
  }
  message RealmInfo {
    string layer = 1;
    string serverName = 2;
    string url = 3;
    int32 usersCount = 4;
    int32 usersMax = 5;
    repeated decentraland.ParcelPosition userParcels = 6;
  }
  message UpdateRealmsInfo {
    message CurrentRealmInfoForRenderer {
      string layer = 1;
      string serverName = 2;
      string domain = 3;
      string contentServerUrl = 4;
    }
    CurrentRealmInfoForRenderer current = 1;
    repeated RealmInfo realms = 2;
  }
  message SendPublishSceneResult {
    bool ok = 1;
    optional string error = 2;
  }
  message SetENSOwnerQueryResult {
    string searchInput = 1;
    bool success = 2;
    repeated ProfileForRenderer profiles = 3;
  }
  message SelectGizmoBuilder {
    string type = 1;
  }
  message SetCameraZoomDeltaBuilder {
    float delta = 1;
  }
  message GetCameraTargetBuilder {
    string futureId = 1;
  }
  message SetPlayModeBuilder {
    string on = 1;
  }
  message PreloadFileBuilder {
    string url = 1;
  }
  message GetMousePositionBuilder {
    float x = 1;
    float y = 2;
    string id = 3;
  }
  message TakeScreenshotBuilder {
     string id = 1;
  }

  message SetCameraPositionBuilder {
    decentraland.Vector3 position = 1;
  }

  message SetCameraRotationBuilder {
    float aplha = 1;
    float beta = 2;
  }

  message SetBuilderGridResolution {
    float position = 1;
    float rotation = 2;
    float scale = 3;
  }

  message SetBuilderSelectedEntities {
    repeated string entities = 1;
  }

  message OnBuilderKeyDown {
    string key = 1;
  }

  message SetBuilderConfiguration {
    float camera_zoomMin = 1;
    float camera_zoomMax = 2;
    float camera_zoomDefault = 3;
    bool disableFloor = 4;
  }

  message SetCursorState {
    bool locked = 1;
  }

  message SetEngineDebugPanel {}
  message HideFPSPanel {}
  message ShowFPSPanel {}
  message SetSceneDebugPanel {}

  message UnloadScene {
    string scene_id = 1;
  }

  message LoadParcelScenes {
    repeated decentraland.ParcelScene parcel_scenes = 1;
  }

  message UpdateParcelScenes {
    repeated decentraland.ParcelScene parcel_scenes = 1;
  }

  message CreateGlobalScene {
    string scene_id = 1;
    string name = 2;
    string base_url = 3;
    repeated decentraland.ContentMapping mappings = 4;
    string icon = 5;
    bool isPortableExperience = 6;
  }

  message DumpScenesLoadInfo {}
  message DumpRendererLockersInfo {}

  message SetRenderProfile {
    string render_profile_id = 1;
  }

  message ProfileForRenderer {
    // TODO fill
  }

  message SetDebug {}
  message LoadProfile {
    ProfileForRenderer profile = 1;
  }
}

enum NotificationType {
  NotificationType_GENERIC = 0;
  NotificationType_SCRIPTING_ERROR = 1;
  NotificationType_COMMS_ERROR = 2;
}

enum PresenceStatus {
  PresenceStatus_NONE = 0;
  PresenceStatus_OFFLINE = 1;
  PresenceStatus_ONLINE = 2;
  PresenceStatus_UNAVAILABLE = 3;
}

enum ChatMessageType {
  ChatMessageType_NONE = 0;
  ChatMessageType_PUBLIC = 1;
  ChatMessageType_PRIVATE = 2;
  ChatMessageType_SYSTEM = 3;
}

enum FriendshipAction {
  FriendshipAction_NONE = 0;
  FriendshipAction_APPROVED = 1;
  FriendshipAction_REJECTED = 2;
  FriendshipAction_CANCELED = 3;
  FriendshipAction_REQUESTED_FROM = 4;
  FriendshipAction_REQUESTED_TO = 5;
  FriendshipAction_DELETED = 6;
}

message ChatMessage {
  string messageId = 1;
  ChatMessageType messageType = 2;
  string sender = 3;
  string recipient = 4;
  int32 timestamp = 5;
  string body = 6;
}